<include file="Public:header" />
<div class="container">
		<div class="page-header">
			<h4>{:L('THE_VIEW_CONTRACT')}</h4>
		</div>
        <div class="row">
			<div class="span12">
				<include file="Public:alert"/>
				<form action="{:U('priceSheet/add')}" method="post">
				    <input type="hidden" name="refer_url" value="{$refer_url}">
				    <input type="hidden" id="add_file" name="add_file" value="{$leadsB.add_file}">
					<table class="table" width="95%" border="0" cellspacing="1" cellpadding="0">
						<tbody width="100%">
							<tr><th <if condition="C('ismobile') eq 1">colspan="2"<else />colspan="4"</if>>{:L('BASIC_INFO')}</th></tr>
							<tr>
								<td width="15%" class="tdleft">{:L('CONTRACT_NO')}</td>
								<td width="35%"><input  type="text" name="number" id="number" value="{$vo.number}"></td>
								<td width="15%" class="tdleft">{:L('SOURCE_OF_CUSTOMERS')}</td>
								<td width="35%" colspan="3">
									<input type="text" name="customer_id" id="customer_id" value="{$vo.customer_name}"/>
								</td>
							</tr>
							<tr>
								<td class="tdleft" >{:L('SERVICE_NAME')}</td>
								<td><input type="text" name="customerB_id" id="customerB_id" value="{$vo.service_name}" /></td>
							
								<td class="tdleft">{:L('OWNER_ROLE')}</td>
								<td>
									<input readonly="readonly" type="text" name="owner_role_name" id="owner_name" value="{$vo.user_name}_{$vo.true_name}"/>
								</td>
							</tr>
							<tr>
								<td class="tdleft">{:L('DEPARTMENT')}</td>
								<td colspan="3"><input type="text" name="department" id="department" value="{$vo.department}" readonly="readonly"/></td>
							</tr>
							<tr>
								<td class="tdleft">{:L('APPLY_REASON')}</td>
								<td <if condition="C('ismobile') neq 1">colspan="3"</if>><textarea class="span6" rows="3" name="reason" id="reason">{$vo.reason}</textarea></td>
							</tr>
							<tr>
	                        	<td class="tdleft" width="15%">附件:</td>
	                        	<if condition="$vo['add_file'] eq ''">
	                            	<td width="35%">{:W('File',array('add_file'=>$vo['add_file'],'mode'=>'add'))}</td>
	                            <else/>
	                            	<td width="35%">{:W('File',array('add_file'=>$vo['add_file'],'mode'=>'show'))}</td>
	                            </if>
                       	 	</tr>
							<tr>
							<th colspan="4">{:L('RELATED_PRODUCTS')}</th>
						</tr>
						<tr>
							<td style="padding:0px;" colspan="4">
								<!-- 隐藏域 -->
								<input type="hidden" name="subtotal_val" class="subtotal_val" value=""/>
								<input type="hidden" name="total_amount" class="total_amount" value=""/>
								<input type="hidden" name="willtotal_val" class="willtotal_val" value=""/>
								<input type="hidden" name="service_val" class="service_val" value=""/>
								<!-- 隐藏域 END-->
								<table class="table table-bordered" id="no-input-border" width="95%" border="0" cellspacing="1" cellpadding="0">
									<thead>
										<tr style="background-color:#E0E8FF;text-align:center;">
											<td class="span2">产品</td>
											<td>数量</td>
											<td>标准目录价</td>
											<td>金额</td>
											<td style="width: 75px;">客户意向单价</td>
											<td>客户意向金额</td>
											<td>服务商单价</td>
											<td>服务商金额</td>
											<td>折扣</td>
											<td>利润率</td>
											<td>产品说明</td>
											<td class="span2">备注</td>
										</tr>
									</thead>
									<tbody id="add_products">
										<foreach name="vo.products" item="v">
											<tr>
												<td><input type="text" value="{$v.product_name}" title="{$v.product_name}" readonly="readonly"/></td>
												<td>{$v.amount}</td>
												<td>{$v.unit_price}</td>
												<td>{$v.subtotal}</td>
												<td>{$v.will_price}</td>
												<td>{$v.will_total}</td>
												<td>{$v.provider_price}</td>
												<td>{$v.provider_total}</td>
												<td>{$v.tax_rate}</td>
												<td>{$v.lirun}</td>
												<td><input type="text" value="{$v.discount_rate}" readonly="readonly"/></td>
												<td>{$v.discription}</td>
											</tr>
										</foreach>
									</tbody>
									<tbody id="add_pro">
										<tr style="background-color:#FFFFF3;color:#808080">
											<td>合计</td>
											<td id="total_amount_val" style="text-align:center">{$vo.total_amount}</td>
											<td></td>
											<td id="subtotal_val" style="text-align:center" name="subtotal_val">{$vo.subtotal_val}</td>
											<td></td>
											<td id="willtotal_val" style="text-align:center" name="willtotal_val">{$vo.willtotal_val}</td>
											<td></td>
											<td id="service_val" style="text-align:center" name="service_val">{$vo.service_val}</td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
									</tbody> 
								</table>
							</td>
						</tr>
						</tbody>
						<tfoot>
							<tr>
								<td colspan="2"></td>
								<td colspan="2">
									<input class="btn" type="button" onclick="javascript:history.go(-1)" value="{:L('RETURN')}"/>&nbsp;&nbsp;
								</td>
							</tr>
						</tfoot>
					</table>
				</form>
			</div>
		</div>
	</div>
<div class="hide" id="dialog-product" title="{:L('ADD_PRODUCT')}">loading...</div>
<div class="hide" id="dialog-edit" title="{:L('AMENDING_THE_CONTRACT_PRODUCT_INFORMATION')}">loading...</div>
<div class="hide" id="dialog-role-info" title="{:L('DIALOG_USER_INFO')}">loading...</div>
<div class="hide" id="dialog-receivables" title="{:L('ADD_THE_ACCOUNTS_RECEIVABLE')}">loading...</div>
<div class="hide" id="dialog-payables" title="添加应付款">loading...</div>
<div class="hide" id="dialog-receivables-edit" title="编辑应收款">loading...</div>
<div class="hide" id="dialog-payables-edit" title="编辑应付款">loading...</div>
<div class="hide" id="dialog-file" title="{:L('ADD_ACCESSORY')}">loading...</div>
<script>
$('#left_list a').click(function (e) {
        e.preventDefault();
        $('#right_list').hide();
        $('#left_list').parent().next().removeClass('span8').addClass('span10');
        $(this).tab('show');
    })
    $('#left_list a:first').on('click', function (e) {
        $('#left_list').parent().next().removeClass('span10').addClass('span8');
        $('#right_list').show();
    })
<if condition="C('ismobile') eq 1">width=$('.container').width() * 0.9;<else />width=800;</if>
$("#dialog-product").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight:400,
	position: ["center",100]
});
$("#dialog-edit").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight:400,
	position: ["center",100]
});
$("#dialog-role-info").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight:400,
	position: ["center",100]
});
$("#dialog-receivables").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight:400,
	position: ["center",100]
});
$("#dialog-receivables-edit").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight:400,
	position: ["center",100]
});
$("#dialog-payables").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight:450,
	position: ["center",100]
});
$("#dialog-payables-edit").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight:450,
	position: ["center",100]
});
$("#dialog-file").dialog({
    autoOpen: false,
    modal: true,
	width: width,
	maxHeight: 400,
	position: ["center",100]
});
$(function(){
	$(".edit_product").click(function(){
		id = $(this).attr('rel');
		$('#dialog-edit').dialog('open');
		$('#dialog-edit').load('{:U("product/editdialog","r=RContractProduct&id")}'+id);
	});
	$(".add_product").click(function(){
		$('#dialog-product').dialog('open');
		$('#dialog-product').load('{:U("product/adddialog","r=RContractProduct&module=contract&id=".$info["contract_id"])}');
	});
	$(".role_info").click(function(){
		$role_id = $(this).attr('rel');
		$('#dialog-role-info').dialog('open');
		$('#dialog-role-info').load('{:U("user/dialoginfo","id=")}'+$role_id);
	});
	$(".add_receivables").click(function(){
		$('#dialog-receivables').dialog('open');
		$('#dialog-receivables').load('{:U("finance/adddialog", "t=receivables&contract_id=".$info['contract_id'])}');
	});
	$(".edit_receivables").click(function(){
		var receivables_id = $(this).attr('rel');
		$('#dialog-receivables-edit').dialog('open');
		$('#dialog-receivables-edit').load('{:U("finance/editdialog", "t=receivables&id=")}'+receivables_id);
	});
	$(".add_payables").click(function(){
		$('#dialog-payables').dialog('open');
		$('#dialog-payables').load('{:U("finance/adddialog", "t=payables&contract_id=".$info['contract_id'])}');
	});
	$(".edit_payables").click(function(){
		var payables_id = $(this).attr('rel');
		$('#dialog-payables-edit').dialog('open');
		$('#dialog-payables-edit').load('{:U("finance/editdialog", "t=payables&id=")}'+payables_id);
	});
	$(".add_file").click(function(){
		$('#dialog-file').dialog('open');
		$('#dialog-file').load('{:U("file/add","r=RContractFile&module=contract&id=".$info["contract_id"])}');
	});
});
</script>
<include file="Public:footer" />	