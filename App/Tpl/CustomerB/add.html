<include file="Public:header" />
<script type="text/javascript" src="__PUBLIC__/js/kindeditor-all-min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/zh_CN.js"></script>
<script src="__PUBLIC__/js/PCASClass.js" type="text/javascript"></script>
<script>
var service_item_data = "{$service_item_data}";
</script>
<script src="__PUBLIC__/js/PCAS2Class.js" type="text/javascript"></script>
<script type="text/javascript" src="__PUBLIC__/js/formValidator-4.0.1.min.js" charset="UTF-8"></script>
<script type="text/javascript" src="__PUBLIC__/js/formValidatorRegex.js" charset="UTF-8"></script>
<link rel="stylesheet" href="__PUBLIC__/css/kindeditor.css" type="text/css" />

<div class="container">
	<!-- Docs nav ================================================== -->
	<div class="page-header">
		<h4>{:L('ADD_THE_CUSTOMERB')}</h4>
	</div>
	<div class="row">
		<div class="span12">
			<include file="Public:alert" />
			<form id="form1" action="{:U(customerB/add)}" method="post">
			     <input type="hidden" name="refer_url" value="{$refer_url}">
			     <input type="hidden" id="add_file" name="add_file" value="{$leadsB.add_file}">
                <table class="table" width="95%" border="0" cellspacing="1" cellpadding="0">
					<tbody>
						<tr><th colspan="4">{:L('KEY_MESSAGE')}</th></tr>
						
						<tr>
                            <td class="tdleft">服务类型:</td>
                            <td>
                            	<script type="text/javascript">
								$(function(){
									new PCAS2("service['class']","service['item']","{$service_array[0]}","{$service_array[1]}");
								});
								</script>
								<select name="service['class']" id="service" class="input-medium"></select> 
								<select name="service['item']" class="input-medium"></select>
								<span id="serviceTip" style="color:red;"></span>
							</td>
                        <php>$j=0;</php>
						<volist name="field_list['main']" id="vo">
                        <php>if($vo['in_add']) { $j++;</php>
                        <if condition="$vo['form_type'] == 'textarea' or $vo['form_type'] == 'editor' or $vo['form_type'] == 'address'">
                            <if condition="$i%2 != 0">
                            <td colspan="2">&nbsp;</td>
                            </tr>
                            </if>
                            <tr>
                                <td class="tdleft" width="15%">{$vo.name}:</td>
                                <td colspan="3">{$vo.html}</td>
                            </tr>
                            <if condition="$i%2 == 0 && count($field_list['main']) != $j">
                            <php>$i++;</php>
                            </if>
                        <else/>
                            <if condition="$i%2 == 0">
                            <tr>
                            </if>
                                <td class="tdleft" width="15%">{$vo.name}:</td>
                                <td width="35%">{$vo.html}</td>
                            <if condition="$i%2 != 0">
                            </tr>
                            </if>
                            <if condition="$i%2 == 0 && count($field_list['main']) == $j">
                                <td colspan="2">&nbsp;</td>
                                </tr>
                            </if>
                        </if>
						<php>}</php>
						</volist>
						<tr>
							<th colspan="4">{:L('THE_PRIMARY_CONTACT_INFORMATION')}</th>
                        </tr>
                        <tr>
                            <td class="tdleft" >{:L('NAME')}</td>
                            <td><input class="user_input" type="text" name="con_name" id="con_name" value="{$leadsB['contactsB_name']}"><span id="con_nameTip" style="color:red;"></span></td>
                            <td class="tdleft" >{:L('SEX')}</td>
                            <td>
                            	<select id="con_sex" name="con_sex">
	                            	<option value="">--请选择--</option>
	                            	<option value="男" <if condition="$leadsB['sex'] eq '男'">selected="selected"</if> >男</option>
	                            	<option value="女" <if condition="$leadsB['sex'] eq '女'">selected="selected"</if> >女</option>
                            	</select>
                            	<span id="con_sexTip" style="color:red;"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="tdleft" >{:L('MAILBOX')}</td>
                            <td><input class="user_input" name="con_email" id="con_email" type="text"  value="{$leadsB['email']}"/><span id="con_emailTip" style="color:red;"></span></td>
                            <td class="tdleft" >{:L('POSITION')}</td>
                            <td>
                                <input class="user_input"  value="{$leadsB['position']}" type="text" name="con_post"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="tdleft">QQ</td>
                            <td><input class="user_input" name="con_qq" data-type="nummber"  type="text" value="{$leadsB['qqnumber']}" /></td>
                            <td class="tdleft" >{:L('CELLPHONE')}</td>
                            <td><input class="user_input" name="con_telephone" id="con_telephone" data-type="nummber"  value="{$leadsB['mobile']}" type="text" /><span id="con_telephoneTip" style="color:red;"></span></td>
                        </tr>
                        <tr>
                            <td class="tdleft">微信</td>
                            <td><input class="user_input" name="con_weixin" data-type="nummber"  type="text" value="{$leadsB['weixin']}" /></td>
                        </tr>
						<tr>
                            <td class="tdleft" >{:L('REMARK')}</td>
                            <td colspan="3"><textarea class="span8" rows="3" name="con_description" ></textarea></td>
                        </tr>
						<tr><th  colspan="4">{:L('OVERHEAD_INFORMATION')}</th></tr>
						<php>$j=0;</php>
						<volist name="field_list['data']" id="vo">
                        <php>if($vo['in_add']){ $j++;</php>
                        <if condition="$vo['form_type'] == 'textarea' or $vo['form_type'] == 'editor'  or $vo['form_type'] == 'address'">
                            <if condition="$i%2 == 0">
                            <td colspan="2">&nbsp;</td>
                            </tr>
                            </if>
                            <tr>
                                <td class="tdleft" width="15%">{$vo.name}:</td>
                                <td colspan="3">{$vo.html}</td>
                            </tr>
                            <if condition="$i%2 != 0 && count($field_list['data']) != $j">
                            <php>$i++;</php>
                            </if>
                        <else/>
                            <if condition="$i%2 != 0">
                            <tr>
                            </if>
                                <td class="tdleft" width="15%">{$vo.name}:</td>
                                <td width="35%">{$vo.html}</td>
                            <if condition="$i%2 == 0">
                            </tr>
                            </if>
                            <if condition="$i%2 != 0 && count($field_list['data']) == $j">
                                <td colspan="2">&nbsp;</td>
                                </tr>
                            </if>
                        </if>
						<php>}</php>
						</volist>
						<tr>
                        	<td class="tdleft" width="15%">附件:</td>
                        	<if condition="$leadsB['add_file'] eq ''">
                        		<td width="35%">{:W('File',array('add_file'=>$vo['add_file'],'mode'=>'add'))}</td>
                        	<else/>
                        		<td width="35%">{:W('File',array('add_file'=>$leadsB['add_file'],'mode'=>'edit'))}</td>
                        	</if>
                        </tr>
					</tbody>
					<tfoot>
						<tr>
							<td style="text-align:center;" colspan="4">
                                <input class="btn btn-primary" name="submit" type="submit" value="{:L('SAVE')}"/>&nbsp;&nbsp;
                                <input class="btn btn-primary" name="submit" type="submit" value="{:L('SAVE_AND_NEW')}"/>&nbsp;&nbsp;
                                <input class="btn" type="button" onclick="javascript:history.go(-1)" value="{:L('RETURN')}"/>&nbsp;
                                <!-- <input type="checkbox" name="create_business1" value="1"/>{:L('AT_THE_SAME_TIME_CREATING_BUSINESS_OPPORTUNITIES')} -->
							</td>
						</tr>
					</tfoot>
                </table>
                <if condition="$leadsB['leadsB_id']"><input type="hidden" name="leadsB_id" value="{$leadsB['leadsB_id']}"/></if>
			</form>
		</div>
	</div>
</div>
<div id="dialog-role-list" class="hide" title="{:L('SELECT_ALL_OF_CUSTOMERBS')}">loading...</div>
<div id="dialog-contacts-add" class="hide" title="{:L('ADD_A_CONTACT')}">loading...</div>
<div class="hide" id="dialog-validate" title="{:L('CUSTOMERB_NAME_TEST_RESULTS')}">
	{:L('HAVE_THE_FOLLOWING_CUSTOMERBS_ARE_SIMILAR_TO_THE_CUSTOMERB_NAME')}
	<div id="search_content"></div>
</div>
<script type="text/javascript">
<if condition="C('ismobile') eq 1">width=$('.container').width() * 0.9;<else/>width=900;</if>
$("#dialog-role-list").dialog({
	autoOpen: false,
	modal: true,
	width: width,
	maxHeight: 400,
	buttons: { 
		"Ok": function () {
			var item = $('input:radio[name="owner"]:checked').val();
			var name = $('input:radio[name="owner"]:checked').parent().next().html();
			if(item){
				$('#owner_name').val(name);
				$('#owner_id').val(item);
			}
			$(this).dialog("close"); 
		},
		"Cancel": function () {
			$(this).dialog("close");
		}
	},
	position: ["center", 100]
});
$("#dialog-contacts-add").dialog({
	autoOpen: false,
	modal: true,
	width: width,
	maxHeight: 400,
	buttons: {
		"Ok": function () {
			
		},
		"Cancel": function () {
			$(this).dialog("close");
		}
	},
	position: ["center", 100]
});
$("#dialog-validate").dialog({
	autoOpen: false,
	modal: true,
	width: 400,
	maxHeight: 400,
	buttons: { 
		"OK": function () {
			$(this).dialog("close"); 
		}
	},
	position: ["center", 100]
});
$(function(){
	$('#owner_name').click(
		function(){
			$('#dialog-role-list').dialog('open');
			$('#dialog-role-list').load("{:U('user/listDialog')}");
		}
	);
	$('#add_contacts').click(
		function(){
			$('#dialog-role-list').dialog('open');
			$('#dialog-role-list').load("{:U('contacts/add_dialog')}");
		}
	);
	$('#remove').click(
		function(){
			$('#owner_id').attr('value', '');
			$('#owner_name').attr('value', '');
		}
	);
	$('#name').blur(
		function(){
			name = $('#name').val();
			if(name!=''){
				$.post('{:U("customerB/check")}',
					{
						name:name
					},
					function(data){
						if(data.data != 0){
							$result = '';
							$.each(data.data, function(k, v){
								$result += (k+1)+'、'+v+'</br>';
							});
							$('#dialog-validate').dialog('open');
							$("#search_content").html($result);
						}
					},
				'json');
			} else {
				alert('{:L('PLEASE_FILL_OUT_THE_CUSTOMERB_NAME')}');
			}
		}
	)
});
$(function(){
    $.formValidator.initConfig({formID:"form1",debug:false,submitOnce:true,
        onError:function(msg,obj,errorlist){
	        alert(msg);
	    },
    	submitAfterAjaxPrompt : '{:L('THERE_ARE_DATA_ARE_ASYNCHRONOUS_VALIDATION')}'
	});
    
    $("#service").formValidator({
        tipID:"serviceTip",
        empty:false,
        onShow:"<span style='color:red;'>*必须填</span>",
        onFocus:" ",
        onCorrect:"<span style='color:green;'>√</span>"
    }).inputValidator({
        min:1,max:255,
        onShow:"服务类型不能为空",
        onErrorMin:"服务类型必填",
        onErrorMax:"服务类型超出最大长度"
    });
    
    $("#con_name").formValidator({
        tipID:"con_nameTip",
        empty:false,
        onShow:" ",
        onFocus:" ",
        onCorrect:"<span style='color:green;'>√</span>"
    }).inputValidator({
        min:1,max:255,
        onErrorMin:"姓名必填",
        onErrorMax:"姓名超出最大长度"
    });
    
    $("#con_email").formValidator({
        tipID:"con_emailTip",
        empty:true,
        onShow:" ",
        onFocus:" ",
        onCorrect:"<span style='color:green;'>√</span>"
    }).inputValidator({
        min:0,max:255,
        onErrorMin:"邮件{:L('CAN_NOT_EMPTY')}",
        onErrorMax:"邮件{:L('EXCEEDS_THE_MAXIMUM_LENGTH')}255"
    });
    $("#con_email").regexValidator({
        regExp:"email",
        dataType:"enum",
        onError:"邮件{:L('INCORRECT_FORMAT')}"
    });
    
    $("#con_telephone").formValidator({
        tipID:"con_telephoneTip",
        empty:true,
        onShow:" ",
        onFocus:" ",
        onCorrect:"<span style='color:green;'>√</span>"
    }).inputValidator({
        min:0,max:255,
        onErrorMin:"手机{:L('CAN_NOT_EMPTY')}",
        onErrorMax:"手机{:L('EXCEEDS_THE_MAXIMUM_LENGTH')}255"
    });
    $("#con_telephone").regexValidator({
        regExp:"mobile",
        dataType:"enum",
        onError:"手机{:L('INCORRECT_FORMAT')}"
    });
    
<volist name="field_list[main]" id="vo">
    <if condition="$vo['is_validate'] == 1">
        <if condition="$vo['form_type'] != 'box' || $vo['setting']['type'] == 'select'">
	        $("#{$vo['field']}").formValidator({
	            tipID:"{$vo['field']}Tip",
	            <if condition="$vo['is_null'] == 1">
	            onShow:"<span style='color:red;'>{:L('REQUIRED')}</span>",
				empty:false,
	            <else />
	            onShow:" ",
				empty:true,
	            </if>
	            onFocus:" ",
	            onCorrect:"<span style='color:green;'>√</span>"
	        }).inputValidator({
	            <if condition="$vo['is_null'] == 1">
	            min:1,max:{$vo[max_length]|default="255"},
	            onshow:"<font style='color:red;'>{:L('NOT NULL',array($vo[name]))}</font>",
	            <else />
	            min:0,max:{$vo[max_length]|default="255"},
	            </if>
	            onErrorMin:"{:L('NOT NULL',array($vo[name]))}",
	            onErrorMax:"{:L('MAXIMUM_REQUEST_LENGTH_EXCEEDED',array($vo[name]))}"
	         });
            <if condition="$vo['form_type'] == 'email'">
            $("#{$vo[field]}").regexValidator({
                regExp:"email",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'mobile'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"mobile",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'phone'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"tel",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'datetime'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"date",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'number'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"num",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
             </if>
             <if condition="$vo['is_unique'] == 1">
            $("#{$vo[field]}").ajaxValidator({
                dataType : "json",
                type : "GET",
                async : false,
                url : "{:U('customerB/validate')}",
                success : function(data){
                    if( data.status == 1 ) return false;
                    if( data.status == 0 ) return true;
                    return false;
                },
                error: function(jqXHR, textStatus, errorThrown){alert("{:L('The_server_did_not_return_data_may_be_the_server_busy_please_try_again')}"+errorThrown);},
                onError : "{:L('THIS_DISABLED_PLEASE_CHANGE',array($vo[name],$vo[name]))}",
                onWait : "{:L('LEGITIMACY_CHECKING_PLEASE_WAIT',array($vo[name]))}"
            }); 
             </if>
         <else />
             <if condition="$vo['setting']['type'] == 'checkbox'">
             $(":checkbox[name='{$vo['field']}[]']").formValidator({
                 tipID:"{$vo[field]}Tip",
                 <if condition="$vo['is_null'] == 1">
                 onShow:"<span style='color:red;'>{:L('REQUIRED')}</span>",
                 <else />
                 onShow:" ",
                 </if>
                 onFocus:" ",
                 onCorrect:"<span style='color:green;'>√</span>"
             }).inputValidator({
             	<if condition="$vo['is_null'] == 1">
                 min:1,
                 <else/>
                 min:0,
                 </if>
             	onError:"{:L('PLEASE_SELECT',array($vo[name]))}"
             });
             <else />
             $(":radio[name='{$vo['field']}']").formValidator({
                 tipID:"{$vo[field]}Tip",
                 <if condition="$vo['is_null'] == 1">
                 onShow:"<span style='color:red;'>{:L('REQUIRED')}</span>",
                 <else />
                 onShow:" ",
                 </if>
                 onFocus:" ",
                 onCorrect:"<span style='color:green;'>√</span>"
             }).inputValidator({
             	<if condition="$vo['is_null'] == 1">
                 min:1,
                 <else/>
                 min:0,
                 </if>
             	onError:"{:L('PLEASE_SELECT',array($vo[name]))}"
             });
             </if>
         </if>
     </if>
</volist>
<volist name="field_list[data]" id="vo">
    <if condition="$vo['is_validate'] == 1">
        <if condition="$vo['form_type'] != 'box' || $vo['setting']['type'] == 'select'">
	        $("#{$vo['field']}").formValidator({
	            tipID:"{$vo['field']}Tip",
	            <if condition="$vo['is_null'] == 1">
	            onShow:"<span style='color:red;'>{:L('REQUIRED')}</span>",
				empty:false,
	            <else />
	            onShow:" ",
				empty:true,
	            </if>
	            onFocus:" ",
	            onCorrect:"<span style='color:green;'>√</span>"
	        }).inputValidator({
	            <if condition="$vo['is_null'] == 1">
	            min:1,max:{$vo[max_length]|default="255"},
	            onshow:"<font style='color:red;'>{:L('NOT NULL',array($vo[name]))}</font>",
	            <else />
	            min:0,max:{$vo[max_length]|default="255"},
	            </if>
	            onErrorMin:"{:L('NOT NULL',array($vo[name]))}",
	            onErrorMax:"{:L('MAXIMUM_REQUEST_LENGTH_EXCEEDED',array($vo[name]))}"
	         });
            <if condition="$vo['form_type'] == 'email'">
            $("#{$vo[field]}").regexValidator({
                regExp:"email",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'mobile'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"mobile",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'phone'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"tel",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'datetime'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"date",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
            <elseif condition="$vo['form_type'] == 'number'"/>
             $("#{$vo[field]}").regexValidator({
                regExp:"num",
                dataType:"enum",
                onError:"{:L('A_OLUTE_OR_SELF_RELATIVE',array($vo[name]))}"
            });
             </if>
             <if condition="$vo['is_unique'] == 1 && $vo['field']!='name'">
            $("#{$vo[field]}").ajaxValidator({
                dataType : "json",
                type : "GET",
                async : false,
                url : "{:U('customerB/validate')}",
                success : function(data){
                    if( data.status == 1 ) return false;
                    if( data.status == 0 ) return true;
                    return false;
                },
                error: function(jqXHR, textStatus, errorThrown){alert("{:L('The_server_did_not_return_data_may_be_the_server_busy_please_try_again')}"+errorThrown);},
                onError : "{:L('THIS_DISABLED_PLEASE_CHANGE',array($vo[name],$vo[name]))}",
                onWait : "{:L('LEGITIMACY_CHECKING_PLEASE_WAIT',array($vo[name]))}"
            }); 
             </if>
         <else />
             <if condition="$vo['setting']['type'] == 'checkbox'">
             $(":checkbox[name='{$vo['field']}[]']").formValidator({
                 tipID:"{$vo[field]}Tip",
                 <if condition="$vo['is_null'] == 1">
                 onShow:"<span style='color:red;'>{:L('REQUIRED')}</span>",
                 <else />
                 onShow:" ",
                 </if>
                 onFocus:" ",
                 onCorrect:"<span style='color:green;'>√</span>"
             }).inputValidator({
             	<if condition="$vo['is_null'] == 1">
                 min:1,
                 <else/>
                 min:0,
                 </if>
             	onError:"{:L('PLEASE_SELECT',array($vo[name]))}"
             });
             <else />
             $(":radio[name='{$vo['field']}']").formValidator({
                 tipID:"{$vo[field]}Tip",
                 <if condition="$vo['is_null'] == 1">
                 onShow:"<span style='color:red;'>{:L('REQUIRED')}</span>",
                 <else />
                 onShow:" ",
                 </if>
                 onFocus:" ",
                 onCorrect:"<span style='color:green;'>√</span>"
             }).inputValidator({
             	<if condition="$vo['is_null'] == 1">
                 min:1,
                 <else/>
                 min:0,
                 </if>
             	onError:"{:L('PLEASE_SELECT',array($vo[name]))}"
             });
             </if>
         </if>
     </if>
</volist>

});
$("[data-type='nummber']").keyup(function(){
	if(isNaN($(this).val())){
		$(this).val($(this).val().replace(/\D/g,''))
	}
});
</script>
<script type="text/javascript">
	var upload_url = "{:U('upload')}";
	var del_url = "{:U('del_file')}";
	var app_path = "__ROOT__";
	var cookie_prefix = "{:C('COOKIE_PREFIX')}";
	var link_select = "{:U('Popup/link_select')}";
	var _hmt = _hmt || [];
	(function() {
		var hm = document.createElement("script");
		hm.src = "//hm.baidu.com/hm.js?2a935166b0c9b73fef3c8bae58b95fe4";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	})(); 
	
	function is_mobile() {
		return navigator.userAgent.match(/mobile/i);
	}
</script>
<include file="Widget:css" />
<include file="Widget:plugin" />
<include file="Public:footer" />